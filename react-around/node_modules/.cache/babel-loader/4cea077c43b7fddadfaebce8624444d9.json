{"ast":null,"code":"var _jsxFileName = \"/home/quinn/Projects/GoAround/react-around/src/components/Home.js\";\nimport React from 'react';\nimport { Tabs, Spin, Row, Col, Radio } from 'antd';\nimport { GEO_OPTIONS, POS_KEY, API_ROOT, AUTH_HEADER, TOKEN_KEY, POST_TYPE_IMAGE, POST_TYPE_VIDEO, POST_TYPE_UNKNOWN, TOPIC_AROUND, TOPIC_FACE } from '../constants';\nimport { Gallery } from './Gallery';\nimport { CreatePostButton } from './CreatePostButton';\nimport { AroundMap } from './AroundMap';\nconst {\n  TabPane\n} = Tabs;\nexport class Home extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      isLoadingGeoLocation: false,\n      isLoadingPosts: false,\n      error: '',\n      posts: [],\n      topic: TOPIC_AROUND\n    };\n\n    this.onSuccessLoadGeoLocation = position => {\n      console.log(position);\n      const {\n        latitude,\n        longitude\n      } = position.coords;\n      localStorage.setItem(POS_KEY, JSON.stringify({\n        lat: latitude,\n        lon: longitude\n      }));\n      this.setState({\n        isLoadingGeoLocation: false,\n        error: ''\n      });\n      this.loadNearbyPosts();\n    };\n\n    this.onFailedLoadGeoLocation = () => {\n      this.setState({\n        isLoadingGeoLocation: false,\n        error: 'Failed to load geo location.'\n      });\n    };\n\n    this.loadNearbyPosts = (center, radius) => {\n      const {\n        lat,\n        lon\n      } = center ? center : JSON.parse(localStorage.getItem(POS_KEY));\n      const range = radius ? radius : 20;\n      const token = localStorage.getItem(TOKEN_KEY);\n      this.setState({\n        isLoadingPosts: true,\n        error: ''\n      });\n      return fetch(`${API_ROOT}/search?lat=${lat}&lon=${lon}&range=${range}`, {\n        method: 'GET',\n        headers: {\n          Authorization: `${AUTH_HEADER} ${token}`\n        }\n      }).then(response => {\n        if (response.ok) {\n          return response.json();\n        }\n\n        throw new Error('Failed to load posts.');\n      }).then(data => {\n        console.log(data);\n        this.setState({\n          posts: data ? data : [],\n          isLoadingPosts: false\n        });\n      }).catch(e => {\n        console.error(e);\n        this.setState({\n          isLoadingPosts: false,\n          error: e.message\n        });\n      });\n    };\n\n    this.handleTopicChange = e => {\n      const topic = e.target.value;\n      this.setState({\n        topic\n      });\n\n      if (topic === TOPIC_AROUND) {\n        this.loadNearbyPosts();\n      } else {\n        this.loadFacesAroundTheWolrd();\n      }\n    };\n\n    this.loadFacesAroundTheWolrd = () => {\n      const token = localStorage.getItem(TOKEN_KEY);\n      this.setState({\n        isLoadingPosts: true,\n        error: ''\n      });\n      return fetch(`${API_ROOT}/cluster?term=face`, {\n        method: 'GET',\n        headers: {\n          Authorization: `${AUTH_HEADER} ${token}`\n        }\n      }).then(response => {\n        if (response.ok) {\n          return response.json();\n        }\n\n        throw new Error('Failed to load posts');\n      }).then(data => {\n        console.log(data);\n        this.setState({\n          posts: data ? data : [],\n          isLoadingPosts: false\n        });\n      }).catch(e => {\n        console.error(e);\n        this.setState({\n          isLoadingPosts: false,\n          error: e.message\n        });\n      });\n    };\n\n    this.loadPostsByTopic = (center, radius) => {\n      if (this.state.topic === TOPIC_AROUND) {\n        return this.loadNearbyPosts(center, radius);\n      } else {\n        return this.loadFacesAroundTheWolrd();\n      }\n    };\n  }\n\n  componentDidMount() {\n    if (\"geolocation\" in navigator) {\n      this.setState({\n        isLoadingGeoLocation: true,\n        error: ''\n      });\n      navigator.geolocation.getCurrentPosition(this.onSuccessLoadGeoLocation, this.onFailedLoadGeoLocation, GEO_OPTIONS);\n    } else {\n      this.setState({\n        error: 'Geolocation is not supported.'\n      });\n    }\n  }\n\n  renderImagePosts() {\n    const {\n      posts\n    } = this.state;\n    const images = posts.filter(post => post.type === POST_TYPE_IMAGE).map(post => {\n      return {\n        user: post.user,\n        src: post.url,\n        thumbnail: post.url,\n        caption: post.message,\n        thumbnailWidth: 400,\n        thumbnailHeight: 300\n      };\n    });\n    return /*#__PURE__*/React.createElement(Gallery, {\n      images: images,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 12\n      }\n    });\n  }\n\n  renderVideoPosts() {\n    const {\n      posts\n    } = this.state;\n    return /*#__PURE__*/React.createElement(Row, {\n      gutter: 30,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 7\n      }\n    }, posts.filter(post => [POST_TYPE_VIDEO, POST_TYPE_UNKNOWN].includes(post.type)).map(post => /*#__PURE__*/React.createElement(Col, {\n      span: 6,\n      key: post.url,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"video\", {\n      src: post.url,\n      controls: true,\n      className: \"video-block\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 17\n      }\n    }, post.user, \": \", post.message))));\n  }\n\n  renderPosts(type) {\n    const {\n      error,\n      isLoadingGeoLocation,\n      isLoadingPosts,\n      posts\n    } = this.state;\n\n    if (error) {\n      return error;\n    } else if (isLoadingGeoLocation) {\n      return /*#__PURE__*/React.createElement(Spin, {\n        tip: \"Loading geo location...\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 14\n        }\n      });\n    } else if (isLoadingPosts) {\n      return /*#__PURE__*/React.createElement(Spin, {\n        tip: \"Loading posts...\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 14\n        }\n      });\n    } else if (posts.length > 0) {\n      return type === POST_TYPE_IMAGE ? this.renderImagePosts() : this.renderVideoPosts();\n    } else {\n      return 'No nearby posts';\n    }\n  }\n\n  render() {\n    const operations = /*#__PURE__*/React.createElement(CreatePostButton, {\n      loadPostsByTopic: this.loadPostsByTopic,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 7\n      }\n    });\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Radio.Group, {\n      onChange: this.handleTopicChange,\n      value: this.state.topic,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Radio, {\n      value: TOPIC_AROUND,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 11\n      }\n    }, \"Posts Around Me\"), /*#__PURE__*/React.createElement(Radio, {\n      value: TOPIC_FACE,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 11\n      }\n    }, \"Faces Around The World\")), /*#__PURE__*/React.createElement(Tabs, {\n      tabBarExtraContent: operations,\n      className: \"main-tabs\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(TabPane, {\n      tab: \"Image Posts\",\n      key: \"1\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 11\n      }\n    }, this.renderPosts(POST_TYPE_IMAGE)), /*#__PURE__*/React.createElement(TabPane, {\n      tab: \"Video Posts\",\n      key: \"2\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 11\n      }\n    }, this.renderPosts(POST_TYPE_VIDEO)), /*#__PURE__*/React.createElement(TabPane, {\n      tab: \"Map\",\n      key: \"3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(AroundMap, {\n      googleMapURL: \"https://maps.googleapis.com/maps/api/js?key=AIzaSyD3CEh9DXuyjozqptVB5LA-dN7MxWWkr9s&v=3.exp&libraries=geometry,drawing,places\",\n      loadingElement: /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          height: `100%`\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 31\n        }\n      }),\n      containerElement: /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          height: `600px`\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196,\n          columnNumber: 33\n        }\n      }),\n      mapElement: /*#__PURE__*/React.createElement(\"div\", {\n        style: {\n          height: `100%`\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 27\n        }\n      }),\n      posts: this.state.posts,\n      loadPostsByTopic: this.loadPostsByTopic,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 13\n      }\n    }))));\n  }\n\n}","map":{"version":3,"sources":["/home/quinn/Projects/GoAround/react-around/src/components/Home.js"],"names":["React","Tabs","Spin","Row","Col","Radio","GEO_OPTIONS","POS_KEY","API_ROOT","AUTH_HEADER","TOKEN_KEY","POST_TYPE_IMAGE","POST_TYPE_VIDEO","POST_TYPE_UNKNOWN","TOPIC_AROUND","TOPIC_FACE","Gallery","CreatePostButton","AroundMap","TabPane","Home","Component","state","isLoadingGeoLocation","isLoadingPosts","error","posts","topic","onSuccessLoadGeoLocation","position","console","log","latitude","longitude","coords","localStorage","setItem","JSON","stringify","lat","lon","setState","loadNearbyPosts","onFailedLoadGeoLocation","center","radius","parse","getItem","range","token","fetch","method","headers","Authorization","then","response","ok","json","Error","data","catch","e","message","handleTopicChange","target","value","loadFacesAroundTheWolrd","loadPostsByTopic","componentDidMount","navigator","geolocation","getCurrentPosition","renderImagePosts","images","filter","post","type","map","user","src","url","thumbnail","caption","thumbnailWidth","thumbnailHeight","renderVideoPosts","includes","renderPosts","length","render","operations","height"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Tabs, Spin, Row, Col, Radio } from 'antd';\nimport {\n  GEO_OPTIONS,\n  POS_KEY,\n  API_ROOT,\n  AUTH_HEADER,\n  TOKEN_KEY,\n  POST_TYPE_IMAGE,\n  POST_TYPE_VIDEO,\n  POST_TYPE_UNKNOWN,\n  TOPIC_AROUND,\n  TOPIC_FACE,\n} from '../constants';\nimport { Gallery } from './Gallery';\nimport { CreatePostButton } from './CreatePostButton';\nimport { AroundMap } from './AroundMap';\n\nconst { TabPane } = Tabs;\n\nexport class Home extends React.Component {\n  state = {\n    isLoadingGeoLocation: false,\n    isLoadingPosts: false,\n    error: '',\n    posts: [],\n    topic: TOPIC_AROUND,\n  }\n\n  componentDidMount() {\n    if (\"geolocation\" in navigator) {\n      this.setState({ isLoadingGeoLocation: true, error: '' });\n      navigator.geolocation.getCurrentPosition(\n        this.onSuccessLoadGeoLocation,\n        this.onFailedLoadGeoLocation,\n        GEO_OPTIONS,\n      );\n    } else {\n      this.setState({ error: 'Geolocation is not supported.'});\n    }\n  }\n\n  onSuccessLoadGeoLocation = (position) => {\n    console.log(position);\n    const { latitude, longitude } = position.coords;\n    localStorage.setItem(POS_KEY, JSON.stringify({ lat: latitude, lon: longitude }));\n    this.setState({ isLoadingGeoLocation: false, error: '' });\n    this.loadNearbyPosts();\n  }\n\n  onFailedLoadGeoLocation = () => {\n    this.setState({ isLoadingGeoLocation: false, error: 'Failed to load geo location.' });\n  }\n\n  loadNearbyPosts = (center, radius) => {\n    const { lat, lon } = center ? center : JSON.parse(localStorage.getItem(POS_KEY));\n    const range = radius ? radius : 20;\n    const token = localStorage.getItem(TOKEN_KEY);\n    this.setState({ isLoadingPosts: true, error: '' });\n    return fetch(`${API_ROOT}/search?lat=${lat}&lon=${lon}&range=${range}`, {\n      method: 'GET',\n      headers: {\n        Authorization: `${AUTH_HEADER} ${token}`,\n      }\n    })\n      .then((response) => {\n        if (response.ok) {\n          return response.json();\n        }\n        throw new Error('Failed to load posts.');\n      })\n      .then((data) => {\n        console.log(data);\n        this.setState({ posts: data ? data : [], isLoadingPosts: false });\n      })\n      .catch((e) => {\n        console.error(e);\n        this.setState({ isLoadingPosts: false, error: e.message });\n      });\n  }\n\n  renderImagePosts() {\n    const { posts } = this.state;\n    const images = posts\n      .filter((post) => post.type === POST_TYPE_IMAGE)\n      .map((post) => {\n        return {\n          user: post.user,\n          src: post.url,\n          thumbnail: post.url,\n          caption: post.message,\n          thumbnailWidth: 400,\n          thumbnailHeight: 300,\n        };\n      });\n    return <Gallery images={images}/>\n  }\n\n  renderVideoPosts() {\n    const { posts } = this.state;\n    return (\n      <Row gutter={30}>\n        {\n          posts\n            .filter((post) => [POST_TYPE_VIDEO, POST_TYPE_UNKNOWN].includes(post.type))\n            .map((post) => (\n              <Col span={6} key={post.url}>\n                <video src={post.url} controls={true} className=\"video-block\"/>\n                <p>{post.user}: {post.message}</p>\n              </Col>\n            ))\n        }\n      </Row>\n    );\n  }\n\n  renderPosts(type) {\n    const { error, isLoadingGeoLocation, isLoadingPosts, posts } = this.state;\n    if (error) {\n      return error;\n    } else if (isLoadingGeoLocation) {\n      return <Spin tip=\"Loading geo location...\"/>;\n    } else if (isLoadingPosts) {\n      return <Spin tip=\"Loading posts...\"/>\n    } else if (posts.length > 0) {\n      return type === POST_TYPE_IMAGE ? this.renderImagePosts() : this.renderVideoPosts();\n    } else {\n      return 'No nearby posts';\n    }\n  }\n\n  handleTopicChange = (e) => {\n    const topic = e.target.value;\n    this.setState({ topic });\n    if (topic === TOPIC_AROUND) {\n      this.loadNearbyPosts();\n    } else {\n      this.loadFacesAroundTheWolrd();\n    }\n  }\n\n  loadFacesAroundTheWolrd = () => {\n    const token = localStorage.getItem(TOKEN_KEY);\n    this.setState({ isLoadingPosts: true, error: '' });\n    return fetch(`${API_ROOT}/cluster?term=face`, {\n      method: 'GET',\n      headers: {\n        Authorization: `${AUTH_HEADER} ${token}`,\n      }\n    })\n      .then((response) => {\n        if (response.ok) {\n          return response.json();\n        }\n        throw new Error('Failed to load posts');\n      })\n      .then((data) => {\n        console.log(data);\n        this.setState({ posts: data ? data : [], isLoadingPosts: false });\n      })\n      .catch((e) => {\n        console.error(e);\n        this.setState({ isLoadingPosts: false , error: e.message });\n      });\n  }\n\n  loadPostsByTopic = (center, radius) => {\n    if (this.state.topic === TOPIC_AROUND) {\n      return this.loadNearbyPosts(center, radius);\n    } else {\n      return this.loadFacesAroundTheWolrd();\n    }\n  }\n\n  render() {\n    const operations = (\n      <CreatePostButton loadPostsByTopic={this.loadPostsByTopic}/>\n    );\n    return (\n      <div>\n        <Radio.Group onChange={this.handleTopicChange} value={this.state.topic}>\n          <Radio value={TOPIC_AROUND}>Posts Around Me</Radio>\n          <Radio value={TOPIC_FACE}>Faces Around The World</Radio>\n        </Radio.Group>\n        <Tabs tabBarExtraContent={operations} className=\"main-tabs\">\n          <TabPane tab=\"Image Posts\" key=\"1\">\n            {this.renderPosts(POST_TYPE_IMAGE)}\n          </TabPane>\n          <TabPane tab=\"Video Posts\" key=\"2\">\n            {this.renderPosts(POST_TYPE_VIDEO)}\n          </TabPane>\n          <TabPane tab=\"Map\" key=\"3\">\n            <AroundMap\n              googleMapURL=\"https://maps.googleapis.com/maps/api/js?key=AIzaSyD3CEh9DXuyjozqptVB5LA-dN7MxWWkr9s&v=3.exp&libraries=geometry,drawing,places\"\n              loadingElement={<div style={{ height: `100%` }} />}\n              containerElement={<div style={{ height: `600px` }} />}\n              mapElement={<div style={{ height: `100%` }} />}\n              posts={this.state.posts}\n              loadPostsByTopic={this.loadPostsByTopic}\n            />\n          </TabPane>\n        </Tabs>\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}